function GameCanvas(t,n,o,e){var l=this;0==arguments.length&&(t=null,n="FULLSCREEN"),this.canvas=t||document.body.appendChild(document.createElement("canvas")),"FULLSCREEN"==(n=n||"FULLSCREEN")?(e=o||e,document.body.style=e&&e.appliedBodyStyle||"padding: 0;margin: 0;",this.canvas.height=window.innerHeight):this.canvas.height=o,this.canvas.width="FULLSCREEN"==n?window.innerWidth:n,this.ctx=this.canvas.getContext("2d"),this.settings=e,this.globalFunctions=!e||!e.hasOwnProperty("globalFunctions")||e.globalFunctions,this.topFunction=this.globalFunctions?window:this,this.imagesToLoad=0,this.preloadedImages=[],this.storedImages=[],this.storedImageData=[],this.topFunction.width=this.canvas.width,this.topFunction.height=this.canvas.height,this.topFunction.isItWorking=function(){msg="Yup, it's working!\n(This function can be removed from your code now if you want)",console.log(msg)},window.onload=function(){if("undefined"!=typeof preload&&"function"==typeof preload)preload();else{var t=loop;loop=function(){t(),requestAnimationFrame(loop)};try{start()}catch(t){console.log(t)}try{loop()}catch(t){console.log(t)}}},this.topFunction.clearScreen=function(){l.ctx.clearRect(0,0,l.canvas.width,l.canvas.height)},this.topFunction.drawRectangle=function(t,n,o,e,i,a,c){l.ctx.beginPath(),l.ctx.rect(t,n,o,e),l.ctx.closePath(),l.topFunction.renderShape(i,a,c)},this.topFunction.rect=this.topFunction.drawRectangle,this.topFunction.rectangle=this.topFunction.drawRectangle,this.topFunction.drawCircle=function(t,n,o,e,i,a){l.ctx.beginPath(),l.ctx.arc(t,n,o,0,2*Math.PI),l.ctx.closePath(),l.topFunction.renderShape(e,i,a)},this.topFunction.circle=this.topFunction.drawCircle,this.topFunction.drawRing=function(t,n,o,e,i,a){l.topFunction.drawCircle(t,n,o,"",color,{lineWidth:a})},this.topFunction.ring=this.topFunction.drawRing,this.topFunction.drawTriangle=function(t,n,o,e,i,a,c,r,s){l.ctx.beginPath(),t.hasOwnProperty("x")?(l.ctx.moveTo(t.x,t.y),l.ctx.lineTo(n.x,n.y),l.ctx.lineTo(o.x,o.y),color=e,s=i):(l.ctx.moveTo(t,n),l.ctx.lineTo(o,e),l.ctx.lineTo(i,a)),l.ctx.closePath(),l.topFunction.renderShape(c,r,s)},this.topFunction.triangle=this.topFunction.drawTriangle,this.topFunction.tri=this.topFunction.drawTriangle,this.topFunction.drawTriangleEquilateral=function(t,n,o,e,i){var a=t+Math.cos(30*Math.PI/180)*(i&&i.width||o),c=n+Math.sin(30*Math.PI/180)*(i&&i.height||o),r=t+Math.cos(150*Math.PI/180)*(i&&i.width||o),s=n+Math.sin(150*Math.PI/180)*(i&&i.height||o),u=t,h=n-o;l.topFunction.drawTriangle(a,c,r,s,u,h,e,i)},this.topFunction.triangleEq=this.topFunction.drawTriangleEquilateral,this.topFunction.drawRegularPolygon=function(t,n,o,e,i,a,c){l.ctx.beginPath();for(var r=-90;r<270;r+=360/e){var s=t+Math.cos(r*Math.PI/180)*(c&&c.width||o),u=n+Math.sin(r*Math.PI/180)*(c&&c.height||o);-90==r?l.ctx.moveTo(s,u):l.ctx.lineTo(s,u)}l.ctx.closePath(),l.topFunction.renderShape(i,a,c)},this.topFunction.regPolygon=this.topFunction.drawRegularPolygon,this.topFunction.drawEllipse=function(t,n,o,e,i,a,c){l.ctx.beginPath(),l.ctx.ellipse(t,n,o,e,c&&c.rotation||0,0,2*Math.PI),l.ctx.closePath(),l.topFunction.renderShape(i,a,c)},this.topFunction.ellipse=this.topFunction.drawEllipse,this.topFunction.oval=this.topFunction.drawEllipse,this.topFunction.preloadImage=function(n){var t=l.preloadedImages.find(function(t){return t.src===n});if(console.log("Preloading image... "+n),!t){l.imagesToLoad++;var o=new Image;return o.src=n,o.onload=function(){if(l.imagesToLoad--,l.imagesToLoad<=0){var t=loop;loop=function(){t(),requestAnimationFrame(loop)};try{start()}catch(t){console.log(t)}try{loop()}catch(t){console.log(t)}}console.log("Image preloaded! "+o.src)},l.preloadedImages.push({src:n,image:o}),o}},this.topFunction.drawImage=function(n,t,o,e,i,a){var c=l.preloadedImages.find(function(t){return t.src===n});if(c)a&&void 0!==a.rotation&&null!==a.rotation?(l.ctx.save(),l.ctx.translate(t,o),l.ctx.rotate(a.rotation),l.ctx.drawImage(c.image,-e/2,-i/2,e,i),l.ctx.restore()):l.ctx.drawImage(c.image,t,o,e,i);else{var r=l.topFunction.preloadImage(n);r.onload=function(){l.ctx.drawImage(r,t,o,e,i)}}},this.topFunction.image=this.topFunction.drawImage,this.topFunction.picture=this.topFunction.drawImage,this.topFunction.imageReadPixel=function(n,t,o){var e=l.storedImageData.find(function(t){return t.src===n});if(e)return e.imagePixelReader.isDoneLoading?e.imagePixelReader.readPixel(t,o):"Data is added, but has not loaded yet";var i=new l.topFunction.ImagePixelReader(n);return l.storedImageData.push({src:n,imagePixelReader:i}),i.readPixel(t,o)},this.topFunction.ImagePixelReader=function(n){var e=this,t=l.preloadedImages.find(function(t){return t.src===n});t?(e.image=t.image,e.isDoneLoading=!0,e.canvas=document.createElement("canvas"),e.canvas.width=e.image.width,e.canvas.height=e.image.height,e.ctx=e.canvas.getContext("2d"),e.ctx.drawImage(e.image,0,0),e.imageData=e.ctx.getImageData(0,0,e.image.width,e.image.height).data):console.error("Please preload image before getting data!"),this.readPixel=function(t,n){if(e.isDoneLoading){var o=4*(t+n*e.image.height);return[e.imageData[o],e.imageData[o+1],e.imageData[o+2],e.imageData[o+3]]}console.log("Is loading!..")},this.onload=function(){}},this.topFunction.drawLine=function(t,n,o,e,i,a){l.ctx.beginPath(),t.hasOwnProperty("x")?(l.ctx.moveTo(t.x,t.y),l.ctx.lineTo(n.x,n.y),i=o,a=e):(l.ctx.moveTo(t,n),l.ctx.lineTo(o,e)),l.ctx.closePath(),l.ctx.lineCap=a&&a.roundedCorners?"round":"butt",l.ctx.strokeStyle=i,l.ctx.lineWidth=a&&a.lineWidth||2,l.ctx.stroke()},this.topFunction.line=this.topFunction.drawLine,this.topFunction.drawPoint=function(t,n){t.hasOwnProperty("x")&&(n=t.y,t=t.x),l.topFunction.drawCircle(t,n,5,"black")},this.topFunction.point=this.topFunction.drawPoint,this.topFunction.drawText=function(t,n,o,e,i,a,c){l.ctx.beginPath(),l.ctx.font=(e||30)+"px "+(c&&c.fontFamily)||"Arial",l.ctx.textAlign=c&&c.alignText||"left",l.ctx.closePath(),l.topFunction.renderShape(i,a,c)},this.topFunction.text=this.topFunction.drawText,this.topFunction.drawPolygon=function(t,n,o,e){var i=t.constructor===Array?t:arguments;l.ctx.beginPath(),l.ctx.moveTo(i[0].x,i[0].y);for(var a=1;a<i.length;a++){var c=i[a];l.ctx.lineTo(c.x,c.y)}l.ctx.closePath(),l.topFunction.renderShape(n,o,e)},this.topFunction.polygon=this.topFunction.drawPolygon,this.topFunction.gradient=function(t,n,o,e){var i;t.constructor===Array?(o,o=n,i=t):i=[t,n];for(var a=l.ctx.createLinearGradient(0,0,0,o||100),c=0;c<i.length;c++)a.addColorStop(1/(i.length-1)*c,i[c]);return a},this.topFunction.beginShape=function(){l.ctx.beginPath()},this.topFunction.moveTo=function(t,n){l.ctx.moveTo(t,n)},this.topFunction.lineTo=function(t,n){l.ctx.lineTo(t,n)},this.topFunction.curveTo=function(t,n,o,e){l.ctx.quadraticCurveTo(o,e,t,n)},this.topFunction.closeShape=function(){l.ctx.closePath()},this.topFunction.renderShape=function(t,n,o){"object"==typeof t&&"[object Object]"===t.toString()&&(o=t,t=""),"object"==typeof n&&"[object Object]"===n.toString()&&(o=n,n=""),l.ctx.lineJoin=o&&o.roundedCorners?"round":"miter",l.ctx.lineWidth=o&&o.lineWidth||2,o&&o.hasOwnProperty("fillColor")&&(l.ctx.fillStyle=o.fillColor,l.ctx.fill()),o&&o.hasOwnProperty("strokeColor")&&(l.ctx.strokeStyle=o.strokeColor,l.ctx.stroke()),t&&(l.ctx.fillStyle=t,l.ctx.fill()),n&&(l.ctx.strokeStyle=n,l.ctx.stroke())},this.topFunction.getDistance=function(t,n,o,e){t.hasOwnProperty("x")&&(e=n.y,o=n.x,n=t.y,t=t.x);var i=t-o,a=n-e;return Math.sqrt(i*i+a*a)},this.topFunction.distance=this.topFunction.getDistance,this.topFunction.getAngle=function(t,n,o,e,i){return t.hasOwnProperty("x")&&(i=o,e=n.y,o=n.x,n=t.y,t=t.x),i&&i.angleMode&&("DEG"==i.angleMode.toUpperCase()||"DEGREES"==i.angleMode.toUpperCase())?180*Math.atan2(e-n,o-t)/Math.PI:i&&i.angleMode&&("RAD"==i.angleMode.toUpperCase()||"RADIUS"==i.angleMode.toUpperCase())||!i?Math.atan2(e-n,o-t):void 0},this.topFunction.canvasToURL=function(){return l.canvas.toDataURL()},this.topFunction.canvasToImage=function(){var t=new Image;return t.src=l.canvas.toDataURL(),t},this.topFunction.downloadCanvasPNG=function(t){var n=document.createElement("a");n.download=t||"downloadCanvasPNG.png",n.href=l.canvas.toDataURL(),n.click()},this.topFunction.swap=function(t,n){return[n,t]},this.topFunction.mouse={x:0,y:0,left:!1,middle:!1,right:!1},this.topFunction.mouseX=0,this.topFunction.mouseY=0,this.topFunction.keyNumber=[],this.topFunction.keyName=[],this.topFunction.isKeyPressed=function(t){return isNaN(t)?!!l.keyName[t]:!!l.keyNumber[t]},this.topFunction.getKey=this.topFunction.isKeyPressed,this.canvas.addEventListener("mousemove",function(t){l.topFunction.mouse.x=l.topFunction.mouseX=t.clientX,l.topFunction.mouse.y=l.topFunction.mouseY=t.clientY,"function"==typeof OnMouseMove&&OnMouseMove()}),this.canvas.addEventListener("mousedown",function(t){switch(t.which){case 1:l.topFunction.mouse.left=!0;break;case 2:l.topFunction.mouse.middle=!0;break;case 3:l.topFunction.mouse.right=!0}"function"==typeof OnMouseDown&&OnMouseDown()}),this.canvas.addEventListener("mouseup",function(t){switch(t.which){case 1:l.topFunction.mouse.left=!1;break;case 2:l.topFunction.mouse.middle=!1;break;case 3:l.topFunction.mouse.right=!1}"function"==typeof OnMouseUp&&OnMouseUp()}),document.addEventListener("keydown",function(t){l.topFunction.keyNumber[t.which]=!0,l.topFunction.keyName[t.key]=!0,"function"==typeof OnKeyDown&&OnKeyDown()}),document.addEventListener("keyup",function(t){l.topFunction.keyNumber[t.which]=!1,l.topFunction.keyName[t.key]=!1,"function"==typeof OnKeyUp&&OnkeyUp()})}
